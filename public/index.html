<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>init Lab Game Servers</title>
    </head>
    <body>
        <h1>Half-Life and CS servers</h1>
        <p>
            <em>If you have <a href="https://store.steampowered.com/">Steam</a> installed, click on the server to join the game.</em>
        </p>
        <ul>
            <li><a href="steam://connect/games.initlab.org:27015">games.initlab.org:27015 - Half-Life</a></li>
            <li><a href="steam://connect/games.initlab.org:27016">games.initlab.org:27016 - CS 1.6</a></li>
            <li><a href="steam://connect/games.initlab.org:27017">games.initlab.org:27017 - Half-Life 2 Deathmatch</a></li>
        </ul>
        <a href="https://store.steampowered.com/app/70/HalfLife/" target="_blank">Buy Half-Life on Steam</a><br/>
        <a href="https://store.steampowered.com/app/10/CounterStrike/" target="_blank">Buy Counter-Strike on Steam</a><br/>
        <a href="https://store.steampowered.com/app/220/HalfLife_2/" target="_blank">Buy Half-Life 2 on Steam</a>
        <br>
        <br>
        <div>
            <iframe src="https://cache.gametracker.com/components/html0/?host=46.10.241.179:27015&bgColor=333333&fontColor=cccccc&titleBgColor=222222&titleColor=ff9900&borderColor=555555&linkColor=ffcc00&borderLinkColor=222222&showMap=1&currentPlayersHeight=100&showCurrPlayers=1&topPlayersHeight=100&showTopPlayers=1&showBlogs=0&width=240" frameborder="0" scrolling="no" width="240" height="536"></iframe>
            <iframe src="https://cache.gametracker.com/components/html0/?host=46.10.241.179:27016&bgColor=333333&fontColor=cccccc&titleBgColor=222222&titleColor=ff9900&borderColor=555555&linkColor=ffcc00&borderLinkColor=222222&showMap=1&currentPlayersHeight=100&showCurrPlayers=1&topPlayersHeight=100&showTopPlayers=1&showBlogs=0&width=240" frameborder="0" scrolling="no" width="240" height="536"></iframe>
            <iframe src="https://cache.gametracker.com/components/html0/?host=46.10.241.179:27017&bgColor=333333&fontColor=cccccc&titleBgColor=222222&titleColor=ff9900&borderColor=555555&linkColor=ffcc00&borderLinkColor=222222&showMap=1&currentPlayersHeight=100&showCurrPlayers=1&topPlayersHeight=100&showTopPlayers=1&showBlogs=0&width=240" frameborder="0" scrolling="no" width="240" height="536"></iframe>
        </div>
        <hr/>
        <h1>Xonotic server</h1>
        <ul>
            <li>games.initlab.org:26000</li>
        </ul>
        <a href="https://xonotic.org/download/" target="_blank">Download Xonotic</a>
        <br>
        <br>
        <b>Xonotic extra files (downloaded automatically on demand):</b>
        <ul>
            <li><a href="/download/xonotic/baseq3.pk3" target="_blank">baseq3.pk3</a></li>
            <li><a href="/download/xonotic/q2dm1_q3.pk3" target="_blank">q2dm1_q3.pk3</li>
        </ul>
        <div>
            <a href="https://www.gametracker.com/server_info/46.10.241.179:26000/" target="_blank">
                <img src="https://cache.gametracker.com/server_info/46.10.241.179:26000/b_560_95_1.png" border="0" width="560" height="95" alt="">
            </a>
        </div>
        <hr/>
        <h1>Nintendo Switch LAN Play</h1>
        <ul>
            <li>games.initlab.org:11451</li>
        </ul>
        <a href="http://www.lan-play.com/download" target="_blank">Download client and module</a>
        <br>
        <a href="http://www.lan-play.com/install" target="_blank">Configuration and usage instructions</a>
        <br>
        <p id="slp-loading">Loading data from server ...</p>
        <ul id="slp-box" hidden>
            <li>Players online: <span id="slp-online">...</span></li>
            <li>Players idle: <span id="slp-idle">...</span></li>
            <li>Server version: <span id="slp-version">...</span></li>
        </ul>
        <div id="slp-tables"></div>
        <!--
        <hr />
        <b>OpenRA servers</b>
        <ul>
            <li>games.initlab.org:1234 - RedAlert</li>
            <li>games.initlab.org:1235 - Command & Conquer</li>
            <li>games.initlab.org:1236 - Dune 2000</li>
        </ul>
        <a href="https://www.openra.net/download/" target="_blank">Download OpenRA</a>
        <hr />
        <a href="/admin.html">Admin commands</a>
        -->
        <script src="https://code.jquery.com/jquery-latest.min.js"></script>
        <script>
jQuery(function($) {
    let slpUrl = 'http://games.initlab.org:11451/';
	const slpLoading = $('#slp-loading');
    const slpBox = $('#slp-box');
    const slpTables = $('#slp-tables');

    const gqlQuery = `
    query {
        serverInfo {
            online
            idle
            version
        }
        room {
            ip
            contentId
            hostPlayerName
            nodeCountMax
            nodeCount
            nodes {
                ip
                playerName
            }
        }
    }`;

    function slpShow(resp) {
		slpLoading.attr('hidden', 'hidden');
		slpBox.removeAttr('hidden');

        $.each(resp.data.serverInfo, function(key, value) {
            $('#slp-' + key).text(value);
        });

        slpTables.empty();

        $.each(resp.data.room, function(idx, room) {
        	let table = $('#slp_game_' + room.contentId);

        	if (table.length < 1) {
                table = $('<table>').attr({
                    border: '1',
                    id: 'slp_game_' + room.contentId
                }).append(
                	$('<thead>').append(
						$('<tr>').append(
							$('<th>').attr({
                                colspan: '3'
                            }).text('TODO: Game name [' + room.contentId + ']')
						),
						$('<tr>').append(
							$('<th>').text('Host player'),
							$('<th>').text('Slots'),
							$('<th>').text('Players')
						)
                    )
                );
                slpTables.append(table);
            }

            const row = $('<tr>').append(
    			$('<td>').text(room.hostPlayerName + ' (' + room.ip + ')'),
            	$('<td>').text(room.nodeCount + '/' + room.nodeCountMax),
			    $('<td>').append($('<ul>').append(room.nodes.filter(function(node) {
			    	return node.ip !== room.ip;
                }).map(function(node) {
			    	return $('<li>').text(node.playerName + ' (' + node.ip + ')')
                })))
            );

        	table.append(row);
        });

        setTimeout(slpUpdate, 5000);
    }

    function slpUpdate() {
        return $.post(slpUrl, JSON.stringify({
            query: gqlQuery
        })).then(slpShow);
    }

    slpUpdate().fail(function() {
        slpUrl = '/slp/';

        slpUpdate().fail(function() {
            $('#slp-online, #slp-version').text('Unable to connect');
        });
    });
});
        </script>
    </body>
</html>
